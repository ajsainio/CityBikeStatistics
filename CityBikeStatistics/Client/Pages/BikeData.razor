@page "/bikedata"
@using CityBikeStatistics.Shared
@inject HttpClient Http

<h1>Bike data</h1>

@if (_cityBikeStations == null) {
  <p><em>Loading...</em></p>
} else {
  <table class="table">
    <thead>
      <tr>
        <th>Station name</th>
        <th>Departures</th>
        <th>Returns</th>
        <th>Show all journeys</th>
      </tr>
    </thead>
    <tbody>
      @foreach (var station in _cityBikeStations) {
        <tr>
          <td>@station.StationName</td>
          <td>@station.Departures</td>
          <td>@station.Returns</td>
          <td><button class="btn" @onclick="() => GetStationData(station.StationId)">Open</button></td>
        </tr>
      }
    </tbody>
  </table>

  <StationData CityBikeStationData="_cityBikeData"></StationData>
}

@code {
  private CityBikeDataContract[] _cityBikeData = new CityBikeDataContract[0];
  private CityBikeStationOverview[] _cityBikeStations;

  protected override async Task OnInitializedAsync() {
    _cityBikeStations = await Http.GetFromJsonAsync<CityBikeStationOverview[]>("CityBikeData/Overview");
  }

  private async Task GetStationData(int station) {
    _cityBikeData = await Http.GetFromJsonAsync<CityBikeDataContract[]>($"CityBikeData/DataByStation/{station}");
  }
}
